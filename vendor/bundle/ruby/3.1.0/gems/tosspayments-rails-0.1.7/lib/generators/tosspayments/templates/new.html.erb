<%# 토스페이먼츠 결제 페이지 %>
<div class="payment-container">
  <h1 class="payment-title">결제하기</h1>
  
  <div class="order-summary">
    <h3>주문 정보</h3>
    <div class="order-summary-row">
      <span>상품명:</span>
      <span><%= @order_name %></span>
    </div>
    <div class="order-summary-row">
      <span>주문번호:</span>
      <span><%= @order_id %></span>
    </div>
    <div class="order-summary-row order-summary-total">
      <span>결제금액:</span>
      <span><%= "#{@amount.to_s.gsub(/\B(?=(\d{3})+(?!\d))/, ',')}원" %></span>
    </div>
  </div>

  <%# Stimulus 컨트롤러 사용 (tosspayments) - inline JS 제거 %>
  <div 
    class="tosspayments-payment-wrapper"
    data-controller="tosspayments"
    data-tosspayments-client-key-value="<%= Rails.application.credentials.tosspayments&.client_key || 'YOUR_CLIENT_KEY' %>"
    data-tosspayments-customer-key-value="<%= @customer_key || 'ANONYMOUS' %>"
    data-tosspayments-order-id-value="<%= @order_id %>"
    data-tosspayments-order-name-value="<%= @order_name %>"
    data-tosspayments-success-url-value="<%= polymorphic_url([:success, :payments]) rescue 'http://localhost:3000/payments/success' %>"
    data-tosspayments-fail-url-value="<%= polymorphic_url([:fail, :payments]) rescue 'http://localhost:3000/payments/fail' %>"
  >
    <div id="payment-widget" data-role="payment-widget"></div>
    <div id="agreement" data-role="agreement"></div>
    <button 
      class="btn btn-primary tosspayments-payment-button" 
      data-action="click->tosspayments#requestPayment"
    >
      결제하기
    </button>
  </div>
</div>
